####### To securely erase a disk, you could either #######

shred --verbose --random-source=/dev/zero --iterations=3 /dev/sda

####### Load Turkish characters #######

loadkeys trq

####### Partitioning a Disk: #######

parted -s /dev/sda mklabel msdos
parted -s -a optimal /dev/sda mkpart primary 0% 512MB
parted -s -a optimal /dev/sda mkpart primary 512MB 100%

####### Configuring LUKS: #######

cryptsetup --cipher twofish-xts-plain64 --hash sha512 --key-size 256 luksFormat /dev/sda2
# password: 

cryptsetup luksOpen --allow-discards /dev/sda2 cryptolvm
# password: 



####### LVM #######

# create volume group
pvcreate /dev/mapper/cryptolvm
vgcreate vg /dev/mapper/cryptolvm

# create logical volumes
lvcreate -L 8G vg -n swap
lvcreate -L 100G vg -n root
lvcreate -L 100G vg -n var
lvcreate -l 100%FREE vg -n home

mkfs.ext4 /dev/sda1
mkfs.ext4 /dev/mapper/vg-root
mkfs.ext4 /dev/mapper/vg-var
mkfs.ext4 /dev/mapper/vg-home
mkswap /dev/mapper/vg-swap

mount /dev/mapper/vg-root /mnt
mkdir /mnt/home
mount /dev/mapper/vg-home /mnt/home
mkdir /mnt/var
mount /dev/mapper/vg-var /mnt/var
swapon /dev/mapper/vg-swap
mkdir /mnt/boot
mount /dev/sda1 /mnt/boot

####### Install the base system and other package groups #######

pacstrap /mnt base base-devel grub lvm2 wireless_tools dialog wpa_supplicant wpa_actiond 

####### Generate an fstab file #######

genfstab -U -p /mnt >> /mnt/etc/fstab

####### Chroot into the system #######

arch-chroot /mnt /bin/bash

# Editing /etc/rc.conf
# nano /etc/rc.conf
# USELVM="yes"

####### Hostname #######

echo arch > /etc/hostname
# nano /etc/hosts
# 127.0.0.1   localhost.localdomain localhost arch
# ::1  localhost.localdomain localhost arch

####### Timezone #######

ln -s /usr/share/zoneinfo/Europe/Istanbul /etc/localtime

####### Locale #######

# nano /etc/locale.gen
# en_US.UTF-8 UTF-8
# en_US ISO-8859-1
locale-gen
echo LANG=en_US.UTF-8 > /etc/locale.conf

####### NTP #######

timedatectl set-ntp true
hwclock --systohc --utc

####### Create an initial ramdisk environment #######

# nano /etc/mkinitcpio.conf
# Edit /etc/mkinitcpio.conf and add the word "encrypt" and "lvm2" to HOOKS='...' just before "filesystems"
# HOOKS="base udev autodetect modconf keyboard encrypt lvm2 block filesystems fsck"
# mkinitcpio -p linux

####### Install and configure a bootloader #######

pacman -S grub
# nano /boot/grub/grub.cfg
# --------------------
# GRUB_ENABLE_CRYPTODISK=y to /etc/default/grub
# GRUB_CMDLINE_LINUX="cryptdevice=/dev/sda2:vg:allow-discards root=/dev/mapper/vg-root"
# grub-install --target=i386-pc /dev/sda
# grub-mkconfig -o /boot/grub/grub.cfg
# --------------------

####### Password #######

passwd

####### Generate grub.cfg #######

grub-mkconfig -o /boot/grub/grub.cfg


####### Reboot #######

# exit
# umount -R /mnt/boot
# umount -R /mnt
# cryptsetup luksClose /dev/sda2 cryptolvm

# Maybe ??? cryptsetup luksClose /dev/mapper/cryptolvm

# reboot

####### Post-Installation #######

pacman -Syy
pacman -Syu
pacman -S dialog wpa_supplicant xorg-server xorg-xinit mesa xterm xorg-twm xorg-xclock xf86-video-intel xf86-video-nouveau xf86-video-vesa xf86-input-synaptics xcursor-vanilla-dmz-aa

useradd -m -g users -G audio,games,log,lp,optical,power,scanner,storage,video,wheel -s /bin/bash arch
passwd arch

ln -s /etc/fonts/conf.avail/70-no-bitmaps.conf /etc/fonts/conf.d/
